{% extends 'base.html.twig' %}

{% block title %}Charges{% endblock %}

{% block javascripts %}
<script src="{{ asset('build/total-selected-charges.js') }}"></script>
    <script>
        const snackbar = document.getElementById('snackbar');
        const hideBar = document.getElementById('hideBar');
        hideBar.addEventListener('click', () => snackbar.className = 'hide');
    </script>
{% endblock %}

{% block body %}
    {% if transaction %}
        <div id="snackbar">
            {% if transaction.status == constant('STATUS_PAID', transaction) %}
                We’ve received your payment and in process of updating your account.
            {% elseif transaction.status == constant('STATUS_COMPLETED', transaction) %}
                Thanks for your payment.<br>
                We’ve received your payment and applied it toward your account.
            {% elseif transaction.status == constant('STATUS_FAILED', transaction) %}
                Thanks for your payment.<br>
                We’ve received your payment, but it can’t be applied toward your account at this time.<br>
                Contact us at XXX-XXX-XXXX as soon as possible so we can help you.
            {% elseif transaction.status == constant('STATUS_DECLINED', transaction) %}
                Your payment of ${{ transaction.totalBalance|number_format(2, '.', ',') }} was declined by PayPal.
            {% elseif transaction.status == constant('STATUS_ERROR', transaction) %}
                There was a critical problem with your payment.
            {% endif %}
            <a id="hideBar">X</a>
        </div>
    {% endif %}
<div class="charges__wrapper">
    <div class="charges__inner">
        <div class="charges__title">Hi, {{ full_name }}!</div>

        <p class="charges__sign-out">I am done with payments,
            <a href="{{ path('logout') }}">sign me out</a>.</p>

        {% if user_fees %}
        <div class="charges__total-amount-due">Your total amount due is:
            <span class="charges__total-amount-number">${{ total_Due|number_format(2, '.', ',') }}</span>
        </div>

        <p class="charges__prompt">Select charges you want to pay:</p>

        <form action="{{ path('payment_handler') }}" method="post" id="chargesList" name="chargesList">
            <ul class="charges__list">
                {% for fee in user_fees %}
                <li class="charges__item">
                    <ul class="charges__item-details">
                        <li class="charges__item-checkbox">
                            <input type="checkbox" name="fee[]" value="{{ fee.id }}" data-fee-balance="{{ fee.balance }}" class="charges__item-checkbox-input" />
                        </li>
                        <li class="charges__item-label">{{ fee.label }}</li>
                        <li>{{ fee.title }}</li>
                        <li class="charges__item-balance">
                            ${{ fee.balance|number_format(2, '.', ',') }}</li>
                        <li>{{ fee.date|date('m/d/Y') }}</li>
                    </ul>
                </li>
                {% endfor %}
            </ul>

            <div class="charges__total-amount-selected">Selected charges total:
                <span class="charges__total-amount-selected-number" id="totalSelectedAmount"></span>
            </div>

            <input type="hidden" name="user_id" value="{{ user_id }}">
            <input id="submitButton" type="submit" value="Pay now" class="button button-primary" disabled="disabled" />
        </form>
        {% else %}
        <p>You currently have no charges.</p>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block stylesheets %}
    <style>
        #snackbar {
            visibility: visible;
            min-width: 250px; /* Set a default minimum width */
            margin-left: -125px; /* Divide value of min-width by 2 */
            background-color: #333; /* Black background color */
            color: #fff; /* White text color */
            text-align: center; /* Centered text */
            border-radius: 2px; /* Rounded borders */
            padding: 16px; /* Padding */
            position: fixed; /* Sit on top of the screen */
            z-index: 1; /* Add a z-index if needed */
            left: 50%; /* Center the snackbar */
            top: 78px; /* Right below header */
        }

        #snackbar.hide {
            visibility: hidden;
        }
    </style>
{% endblock %}
